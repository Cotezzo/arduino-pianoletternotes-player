#include <Tone.h>

// NOTES POOL TO REDUCE ARRAY SIZE USING BYTES
const int notes[] = {
  NOTE_B0, NOTE_C1, NOTE_CS1, NOTE_D1, NOTE_DS1, NOTE_E1, NOTE_F1, NOTE_FS1, NOTE_G1, NOTE_GS1, NOTE_A1, NOTE_AS1, NOTE_B1, NOTE_C2, NOTE_CS2, NOTE_D2, NOTE_DS2, NOTE_E2, NOTE_F2, NOTE_FS2, NOTE_G2, NOTE_GS2, NOTE_A2, NOTE_AS2,
  NOTE_B2, NOTE_C3, NOTE_CS3, NOTE_D3, NOTE_DS3, NOTE_E3, NOTE_F3, NOTE_FS3, NOTE_G3, NOTE_GS3, NOTE_A3, NOTE_AS3, NOTE_B3, NOTE_C4, NOTE_CS4, NOTE_D4, NOTE_DS4, NOTE_E4, NOTE_F4, NOTE_FS4, NOTE_G4, NOTE_GS4, NOTE_A4, NOTE_AS4,
  NOTE_B4, NOTE_C5, NOTE_CS5, NOTE_D5, NOTE_DS5, NOTE_E5, NOTE_F5, NOTE_FS5, NOTE_G5, NOTE_GS5, NOTE_A5, NOTE_AS5, NOTE_B5, NOTE_C6, NOTE_CS6, NOTE_D6, NOTE_DS6, NOTE_E6, NOTE_F6, NOTE_FS6, NOTE_G6, NOTE_GS6, NOTE_A6, NOTE_AS6,
  NOTE_B6, NOTE_C7, NOTE_CS7, NOTE_D7, NOTE_DS7, NOTE_E7, NOTE_F7, NOTE_FS7, NOTE_G7, NOTE_GS7, NOTE_A7, NOTE_AS7, NOTE_B7, NOTE_C8, NOTE_CS8, NOTE_D8, NOTE_DS8
};


// ACTUAL MELODY
// Layer 1
const uint8_t map_layer_SX[] = {
  170,175,170,170,170,175,170,170,170,175,170,170,170,175,170,138,183,183,183,187,183,183,183,187,183,183,183,187,183,183,183,221,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,221,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,221,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,138,170,136,183,183,183,187,183,183,183,187,183,183,183,187,183,183,183,221,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,221,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,221,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,138,170,136,182,182,182,182,182,182,182,182,0,0
};

const uint8_t notes_layer_SX[] = {
  16,28,16,28,16,28,16,28,16,28,16,28,16,28,16,28,16,16,16,28,16,28,16,28,16,28,16,28,16,28,16,28,16,28,16,16,16,28,16,28,16,28,16,28,16,28,16,28,16,28,16,28,16,16,16,28,16,28,16,28,16,28,16,28,16,28,16,28,16,77,53,16,16,28,28,26,28,16,16,28,28,26,28,16,16,28,28,26,28,16,28,31,19,31,33,16,16,28,28,26,28,16,16,28,28,26,28,16,16,28,28,26,28,21,31,33,19,28,31,16,16,28,28,26,28,16,16,28,28,26,28,16,16,28,28,26,28,16,28,31,19,31,33,16,16,28,28,26,28,16,16,28,28,26,28,16,16,28,28,26,28,33,31,33,31,28,31,40,42,43,45,47,28,52,50,47,28,40,28,47,45,43,42,40,42,43,45,47,19,45,43,42,40,42,43,42,40,39,42,40,42,43,45,47,28,52,50,47,28,40,28,47,45,43,42,40,42,43,45,47,19,45,43,42,26,43,26,45,27,27,47,27,27,40,42,43,45,47,28,52,50,47,28,40,28,47,45,43,42,40,42,43,45,47,19,45,43,42,40,42,43,42,40,39,42,40,42,43,45,47,28,52,50,47,28,40,28,47,45,43,42,40,42,43,45,47,19,45,43,42,26,43,26,45,27,27,47,27,27,50,52,47,45,47,19,45,47,50,52,47,45,47,26,45,47,45,43,42,38,40,28,38,40,42,43,45,47,40,28,47,50,50,52,47,45,47,19,45,47,50,52,47,45,47,26,45,47,45,43,42,38,40,28,38,40,42,43,45,47,40,28,59,62,62,64,59,57,59,19,57,59,62,64,59,57,59,26,57,59,57,55,54,50,52,28,50,52,54,55,57,59,52,28,59,62,62,64,59,57,59,19,57,59,62,64,59,57,59,26,64,66,67,66,64,62,59,28,57,59,57,55,54,50,52,28,47,50,50,52,47,45,47,19,45,47,50,52,47,45,47,21,45,47,45,43,42,38,40,23,38,40,42,43,45,47,40,23,47,50,50,52,47,45,47,19,45,47,50,52,47,45,47,21,45,47,45,43,42,38,40,23,38,40,42,43,45,47,40,23,59,62,62,64,59,57,59,19,57,59,62,64,59,57,59,21,57,59,57,55,54,50,52,23,50,52,54,55,57,59,52,23,59,62,62,64,59,57,59,19,57,59,62,64,59,57,59,21,64,66,67,66,64,62,59,57,59,57,55,54,50,52,19,16,16,28,28,26,28,16,16,28,28,26,28,16,16,28,28,26,28,16,28,31,19,31,33,16,16,28,28,26,28,16,16,28,28,26,28,16,16,28,28,26,28,21,31,33,19,28,31,16,16,28,28,26,28,16,16,28,28,26,28,16,16,28,28,26,28,16,28,31,19,31,33,16,16,28,28,26,28,16,16,28,28,26,28,16,16,28,28,26,28,33,31,33,31,28,31,40,42,43,45,47,28,52,50,47,28,40,28,47,45,43,42,40,42,43,45,47,24,45,43,42,40,42,43,42,40,39,42,40,42,43,45,47,28,52,50,47,28,40,28,47,45,43,42,40,42,43,45,47,24,45,43,42,26,43,26,45,27,27,47,27,27,40,42,43,45,47,28,52,50,47,28,40,28,47,45,43,42,40,42,43,45,47,24,45,43,42,40,42,43,42,40,39,42,40,42,43,45,47,28,52,50,47,28,40,28,47,45,43,42,40,42,43,45,47,24,45,43,42,26,43,26,45,27,27,47,27,27,50,52,47,45,47,24,45,47,50,52,47,45,47,26,45,47,45,43,42,38,40,28,38,40,42,43,45,47,40,28,47,50,50,52,47,45,47,24,45,47,50,52,47,45,47,26,45,47,45,43,42,38,40,28,38,40,42,43,45,47,40,28,59,62,62,64,59,57,59,24,57,59,62,64,59,57,59,26,57,59,57,55,54,50,52,28,50,52,54,55,57,59,52,28,59,62,62,64,59,57,59,24,57,59,62,64,59,57,59,26,64,66,67,66,64,62,59,28,57,59,57,55,54,50,52,28,48,51,51,53,48,46,48,20,46,48,51,53,48,46,48,22,46,48,46,44,43,39,41,24,39,41,43,44,46,48,41,24,48,51,51,53,48,46,48,20,46,48,51,53,48,46,48,22,46,48,46,44,43,39,41,24,39,41,43,44,46,48,41,24,60,63,63,65,60,58,60,20,58,60,63,65,60,58,60,22,58,60,58,56,55,51,53,24,51,53,55,56,58,60,53,24,60,63,63,65,60,58,60,20,58,60,63,65,60,58,60,22,65,67,68,67,65,63,60,58,60,58,56,55,51,53,29,29,34,36,34,36,34,34,36,34,36,34,34,36,34,36,34,34,36,34,36,34,34,36,34,36,34,34,36,34,36,34,34,36,34,36,34,34,36,34,36
};

int notes_index_SX = 0;

// Layer 2
const uint8_t map_layer_DX[] = {
  42,171,234,170,170,171,234,170,170,171,234,170,170,171,234,160,45,45,45,34,45,45,45,34,45,45,45,34,45,45,45,34,42,170,170,170,170,170,170,170,170,170,170,170,170,170,170,183,106,170,170,170,170,170,170,170,170,170,170,170,170,170,170,183,106,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,45,45,45,34,45,45,45,34,45,45,45,34,45,45,45,34,42,170,170,170,170,170,170,170,170,170,170,170,170,170,170,183,106,170,170,170,170,170,170,170,170,170,170,170,170,170,170,183,106,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,170,162,32,0,0,0,0,0,0,0,0,0
};

const uint8_t notes_layer_DX[] = {
  4,23,4,23,4,23,4,23,4,23,4,23,4,23,4,23,4,4,4,23,4,23,4,23,4,23,4,23,4,23,4,23,4,23,4,4,4,23,4,23,4,23,4,23,4,23,4,23,4,23,4,23,4,4,4,23,4,23,4,23,4,23,4,23,4,23,4,23,4,4,4,23,23,4,4,23,23,4,4,23,23,4,7,4,4,23,23,4,4,23,23,4,4,23,23,9,7,4,4,23,23,4,4,23,23,4,4,23,23,4,7,4,4,23,23,4,4,23,23,4,4,23,23,21,19,16,28,16,28,16,23,16,28,16,23,16,23,16,28,16,28,12,19,12,19,12,24,12,19,14,26,14,26,14,26,14,26,16,28,16,28,16,23,16,28,16,23,16,23,16,28,16,28,12,19,12,19,12,24,12,19,14,21,14,21,27,15,15,27,15,15,35,28,16,28,43,23,16,28,43,23,35,23,16,28,16,28,36,19,12,19,43,24,12,19,38,26,14,26,38,26,14,26,35,28,16,28,43,23,16,28,43,23,35,23,16,28,16,28,36,19,12,19,43,24,12,19,14,21,14,21,27,15,15,27,15,15,12,19,12,19,43,24,12,19,14,26,14,26,42,21,14,26,16,28,16,28,35,23,16,28,16,28,16,28,35,23,14,26,12,19,12,19,43,24,12,19,14,26,14,26,42,21,14,26,16,28,16,28,35,23,16,28,16,28,16,28,35,23,47,50,50,52,47,45,47,24,45,47,50,52,47,45,47,21,45,47,45,43,42,38,40,23,38,40,42,43,45,47,40,23,47,50,50,52,47,45,47,24,45,47,50,52,47,45,47,21,52,54,55,54,52,50,47,23,45,47,45,43,42,38,40,23,16,28,12,19,24,19,28,24,19,14,21,26,21,30,26,21,16,23,28,23,31,28,23,16,23,28,23,31,28,23,12,19,24,19,28,24,19,14,21,26,21,30,26,21,16,23,28,23,31,28,23,16,23,28,23,31,47,50,50,52,47,45,47,45,47,50,52,47,45,47,45,47,45,43,42,38,40,38,40,42,43,45,47,40,47,50,50,52,47,45,47,45,47,50,52,47,45,47,52,54,55,54,52,50,47,45,47,45,43,42,38,40,7,4,4,23,23,4,4,23,23,4,4,23,23,4,7,4,4,23,23,4,4,23,23,4,4,23,23,9,7,4,4,23,23,4,4,23,23,4,4,23,23,4,7,4,4,23,23,4,4,23,23,4,4,23,23,21,19,16,28,16,28,16,23,16,28,16,23,16,23,16,28,16,28,12,24,12,24,12,19,12,24,14,26,14,26,14,26,14,26,16,28,16,28,16,23,16,28,16,23,16,23,16,28,16,28,12,24,12,24,12,19,12,24,14,21,14,21,27,15,15,27,15,15,35,28,16,28,43,23,16,28,43,23,35,23,16,28,16,28,36,24,12,24,43,19,12,24,38,26,14,26,38,26,14,26,35,28,16,28,43,23,16,28,43,23,35,23,16,28,16,28,36,24,12,24,43,19,12,24,14,21,14,21,27,15,15,27,15,15,12,24,12,24,43,19,12,24,14,26,14,26,42,21,14,26,16,28,16,28,35,23,16,28,16,28,16,28,35,23,14,26,12,24,12,24,43,19,12,24,14,26,14,26,42,21,14,26,16,28,16,28,35,23,16,28,16,28,16,28,35,23,47,50,50,52,47,45,47,19,45,47,50,52,47,45,47,21,45,47,45,43,42,38,40,23,38,40,42,43,45,47,40,23,47,50,50,52,47,45,47,19,45,47,50,52,47,45,47,21,52,54,55,54,52,50,47,23,45,47,45,43,42,38,40,23,16,28,13,20,25,20,29,25,20,15,22,27,22,31,27,22,17,24,29,24,32,29,24,17,24,29,24,32,29,24,13,20,25,20,29,25,20,15,22,27,22,31,27,22,17,24,29,24,32,29,24,17,24,29,24,32,48,51,51,53,48,46,48,46,48,51,53,48,46,48,46,48,46,44,43,39,41,39,41,43,44,46,48,41,48,51,51,53,48,46,48,46,48,51,53,48,46,48,53,55,56,55,53,51,48,46,48,46,44,43,39,41,24,34
};

int notes_index_DX = 0;

const int songSize = (sizeof(map_layer_SX)/sizeof(map_layer_SX[0]))*8;  // 1 bit => 1 note
const byte noteDuration = 95;

// AUDIO DEVICES SETUP
Tone AUDIO_SX;
Tone AUDIO_DX;

void setup() {
  AUDIO_SX.begin(3);
  AUDIO_DX.begin(2);
  playMelody();
}

void loop(){}

// PLAY SONG FUNCTION
void playMelody(){
  int i = 0;
  while(i < songSize){
    // if(AUDIO_SX.isPlaying() || AUDIO_DX.isPlaying()) continue;
    if(AUDIO_SX.isPlaying()) continue;      
    // if(AUDIO_DX.isPlaying()) continue;      
    AUDIO_SX.stop();
    AUDIO_DX.stop();
    
    const byte isNote_SX = bitRead(map_layer_SX[i/8], i%8); // Example: i = 5, number 0, 6th bit.
    const byte isNote_DX = bitRead(map_layer_DX[i/8], i%8); // Example: i = 5, number 0, 6th bit.

    if(!isNote_SX && !isNote_DX)
      delay(noteDuration);
    else{
      if(isNote_SX) {
        AUDIO_SX.play(notes[notes_layer_SX[notes_index_SX]], noteDuration);
        notes_index_SX++;
      }
      
      if(isNote_DX) {
        AUDIO_DX.play(notes[notes_layer_DX[notes_index_DX]], noteDuration);
        notes_index_DX++;
      }
    }
    
    i++;
  }

  playMelody();
}
