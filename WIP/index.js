const fs = require("fs");

// Choose how many layers do you need (the number of tracks you can play simultaneously)
const nOfLayers = 2;

// Put here the sheet - the letter notes
const trad = `
4|--dFgFd---dFgFd---dFgFd---|
3|--g-------g---g---g-------|
3|gb-----bgb-----bgb-----bgb|
2|g-----g-----g---g-----g---|

4|dFgFd---dFgFd---dFgFd---dF|
3|g---g---g-------g---g---g-|
3|-----bgb-----bgb-----bgb--|
2|--g---g-----g-----g---g---|

4|gFd---dFgaFg--dFgFd---dFgF|
3|------g---g---g-------g---|
3|---bgb------gb-----bgb----|
2|--g-----g---g-----g-----g-|

4|d---dFgFd---dFgFd---dFgFd-|
3|g---g-------g---g---g-----|
3|-bgb-----bgb-----bgb-----b|
2|--g-----g-----g---g-----g-|

5|------------------dFgaFg--|
4|--dFgFd---dFgFdFgb--------|
3|--g---g---g-------g---g---|
3|gb-----bgb--------------gb|
2|----g---g-----g-----g---g-|

4|dFgFd---dFgFd---dFgFd---dF|
3|g---g---g---g---g---g---g-|
3|-----bgb-----bgb-----bgb--|
2|--g---g---g---g---g---g---|

4|gFd---dFgFd---dFgFd---dFgF|
3|--g---g---g---g---g---g---|
3|---bgb-----bgb-----bgb----|
2|g---g---g---g---g---g---g-|

4|d---dFgaFg--dFgFd---dFgFd-|
3|g---g---g---g---g---g---g-|
3|-bgb------gb-----bgb-----b|
2|--g---g---g---g---g---g---|

4|--------------------d---d-|
4|--dFgFd---dFgFd-d---F---a-|
3|--g---g---g---g-d---d---d-|
3|gb-----bgb-----b----------|
2|g---g---g---g-------------|

6|------------------c---d--d|
5|--c---d---F---a---c----gd-|
4|--d-------c-----------g---|
4|------d---F---a-----------|
3|--d---d---c---b---a---g---|
2|--------------b---a-------|

6|--d--c--c-c---------------|
5|gd-gd-gd-g-gbd-bd-bd-Fd-F-|
4|------------d-------------|
4|--------------b--b--b--b-b|
3|------------d-------------|

5|F-ae-ae-ae-ge-g-g-Fe-Fe-g-|
4|--e-----------------------|
4|-b--b--b--b--b-b-b--b--b-b|
3|--e---------------b-------|
2|------------------b-------|

6|----c-d-ec-ec-e-F-F-g-g-a-|
5|aebe-e-e--g--g-g-g-g-g-g-a|
4|--------c---------------d-|
3|--------c---------------d-|

6|a-g-g-F-F-e-e-e-e-d-d-C-C-|
5|-a-a-a-a-a-a-a-g-g-g-g-g-g|
4|------c-------------------|
3|------c-------b-----------|
2|--------------b-----------|

6|e-e-d--d--d---------c-c-d-|
5|-g-g-ge-ge-gebgebebe-g-g-g|
4|----e---------------c-----|
3|----e---------------c-----|

6|d-e-e-g-g-Fg-Fe-e-d-d-c-c-|
5|-g-g-g-g-g-----g-g-g-g-g-g|
4|----------d-------c-------|
3|----------d-------c-------|

6|----D-D-F-F-b-b-a-a-g-g-F-|
5|bFbF-F-F-F-F-b-b-b-b-b-b-b|
4|----------------e---------|
3|b---------------e---------|
2|b-------------------------|

6|F-g-g-becbecbecbecg-e-becb|
5|-b-b-b-------------a-a----|
4|----------------------c---|
3|------a---------------c---|
2|------a-------------------|

7|-------c--c---------------|
6|e-e-bec-ec-cbFdbFdbFdaFdFd|
5|-a-a----------------------|
4|----C-------d-------------|
3|----C-------d-------------|

7|--d-d-c-c-----------------|
6|add-d-c-c-b-b-a-a---------|
5|----------b-b-a-a---------|
4|------------------d---F---|
3|--d---------------d-------|
2|--d---------------d-------|

6|--------------------c-----|
5|----c---d---F---a---c---d-|
4|a-------d---F---a-------b-|
3|--------d---d---d---d-----|
2|--------d---d---d---d---g-|

5|------e-------------------|
5|--d---c---d---c-----------|
4|------------------b---a---|
4|--b-------b---a---g---F---|
3|g---g---g---g---d---d---D-|
2|--g---g---g---d---d---D---|

5|------------g---g---a---g-|
5|--------e---e---e---F---e-|
4|F---b---------------------|
4|D---g---b-----------------|
3|--D---e---e---e---e-------|
2|D---e---e---e---e-----b---|
1|--------------------b---b-|

5|--F-------e---F---g---e---|
5|--d---d---c---d---e---c---|
4|------b-------------------|
3|------------c---c---c---c-|
2|b---b---b-c---c---c---c---|
1|--b---b-------------------|

5|----a---g---------------e-|
5|d---F---d---d---c---d---C-|
4|b-----------b---a---b-----|
3|--g---g---g---g---c---c---|
2|g---g---g---g---c---c---a-|

5|--g---b---a---g---a-------|
5|--e---g---F---d---F---d---|
4|----------------------b---|
3|a---a---d---d---d---d---g-|
2|--a---d---d---d---d---g---|

5|----e---------------------|
5|d---c---d---c-------------|
4|----------------b---a---F-|
4|b-------b---a---g---F---D-|
3|--g---g---g---d---d---D---|
2|g---g---g---d---d---D---D-|

5|----------g---g---a---g---|
5|------e---e---e---F---e---|
4|--b-----------------------|
4|--g---b-------------------|
3|D---e---e---e---e---------|
2|--e---e---e---e-----b---b-|
1|------------------b---b---|

5|F-------e---F---g---e-----|
5|d---d---c---d---e---c---d-|
4|----b-------------------b-|
3|----------c---c---c---c---|
2|--b---b-c---c---c---c---g-|
1|b---b---------------------|

5|--a---g-------------------|
5|--F---d---d---c-d-e-F-g-c-|
4|--------------------c-----|
4|----------b---------------|
3|g---g---g---g-c-e-g---c-e-|
2|--g---g---g---------------|

6|------------d-c-----d--d--|
5|e-g-a-d-F-a-----b-a--gd-gd|
4|--c-------d-d-d-d-d-------|
3|g---d-F-a---d-d-d-d---g---|
2|--------------------g---g-|

6|d--c--c-c-----------------|
5|-gd-gd-g-gbd-bd-bd-Fd-F-F-|
4|------------b--b--b--b-b-b|
3|g---g---g---d---d---d---d-|
2|--g---g---d---d---d---d---|

5|ae-ae-ae-ge-g-g-Fe-Fe-g-ae|
4|--b--b--b--b-b-b--b--b-b--|
3|--e---e---e---e-----------|
2|e---e---e---e-----b---b---|
1|----------------b---b---b-|

6|--c-d-ec-ec-e-F-F-g-g-a-a-|
5|be-e-e--g--g-g-g-g-g-g-a-a|
3|--------c---c---c---c---d-|
2|b---b-c---c---c---c---d---|
1|--b-----------------------|

6|g-g-F-F-e-e-e-e-d-d-C-C-e-|
5|-a-a-a-a-a-a-g-g-g-g-g-g-g|
3|--d---c---c---------------|
2|d---c---c-----b---b---b---|
1|------------b---b---b---b-|

6|e-d--d--d---------c-c-d-d-|
5|-g-ge-ge-gebgebebe-g-g-g-g|
3|----e---e---e---e---c---c-|
2|b-e---e---e---e---c---c---|

6|e-e-g-g-Fg-Fe-e-d-d-c-c---|
5|-g-g-g-g-----g-g-g-g-g-gbF|
3|--c---c---d---d---c---c---|
2|c---c---d---d---c---c-----|
1|------------------------b-|

6|--D-D-F-F-b-b-a-a-g-g-F-F-|
5|bF-F-F-F-F-b-b-b-b-b-b-b-b|
3|----------------e---e---e-|
2|b---b---b---b-e---e---e---|
1|--b---b---b---------------|

6|g-g-becbecbecbecg-e-becbe-|
5|-b-b-------------a-a-----a|
3|--e---c---c---c---c-------|
2|e---c---c---c---c-----a---|
1|--------------------a---a-|

7|-----c--c-----------------|
6|e-bec-ec-cbFdbFdbFdaFdFdad|
5|-a------------------------|
3|------------d---d---d---d-|
2|a---a---a-d---d---d---d---|
1|--a---a-------------------|

7|d-d-c-c-------------------|
6|d-d-c-c-b-b-a-a-g---------|
5|--------b-b-a-a-g---------|
4|--------------------e-F-g-|
3|--d---d---d---d-e-------c-|
2|d---d---d---d---e-------c-|

5|------------c---c---------|
4|F-g-e-a-g-a---b---b-F-g-F-|
3|------d-------g---F---e---|
2|------d-------g---F---e---|

5|----------------d-F-g-F-d-|
4|e-F-g-F-g-b-F-a-----------|
3|----c-------d-------g-F-d-|
2|----c-------d-------g---d-|

5|------------------------c-|
4|b-e---e-F-g-F-g-e-a-g-a---|
3|--e-------c-------d-------|
3|----b---------------------|
2|--e-------c-------d-------|

5|--c-------------------c-d-|
4|b---b-F-g-F-e-F-g-a-b-----|
3|g---F---e-------c-------d-|
2|g---F---e-------c-------d-|

4|a-F-a-g---F---e---e-F-g-F-|
3|------g-F-d---e-e---e---c-|
3|----------------b---------|
2|------g---d---e-e---e---c-|

5|----------c---c-----------|
4|g-e-a-g-a---b---b-F-g-F-e-|
3|--c---d---d---g---F-e-e---|
2|--c---d---d---g---F-e-e---|

5|--------------d-F-g-F-d---|
4|F-g-F-g-b-F-a-----------b-|
3|e---c---c---d---d---F---d-|
2|e---c---c---d---d---F---d-|

5|----------------------d-C-|
4|F-C-F-G-a-G-a-F-b-a-b-----|
3|F-F---F---d---d---e---e---|
2|F-F---F---d---d---e---e---|

5|d-C---------------C-d-e---|
4|----G-a-G-F-G-a-b-----e---|
3|a---G-F-F---F---d---d---e-|
2|a---G-F-F---F---d---d-e---|

4|------------G-------------|
3|--e---e---e---e---e---e---|
2|e---e---e---e---e---e---e-|

5|------------------d-------|
4|--b-----------------------|
3|e---e---e---e---e---e---e-|
2|--e---e---e---e---e---e---|

5|--------e---e-e-e-e-e-e-G-|
4|--------e---e-e-e-e-e-e-G-|
3|--e---e---e---e---e---e---|
2|e---e---e---e---e---e---e-|

5|--G-G-G-G-G-G-b---b-b-b-b-|
4|--G-G-G-G-G-G-b---b-b-b-b-|
3|e---e---e---e---e---e---e-|
2|--e---e---e---e---e---e---|

6|----d-d-d-d-D-D-D-D-e-----|
5|b-b-d-d-d-d-D-D-D-D-e-----|
4|b-b-----------------------|
3|--e---e---e---e---e-e-----|
2|--------------------b-----|
2|e---e---e---e---e---e-----|
2|--------------------G-----|

6|---------ee--e--e--d--d-d-|
5|------eGb--ae-ae-ae-ae-a-a|
3|------------a---a---a---a-|
2|----------a---a---a---a---|

6|C--C--C-------------------|
5|-eC-eC-eCGeCGCGCbFCbFCbFCa|
3|--e---e---e---e---F---F---|
2|e---e---e---e---F---F---F-|

6|----------------C-d-e-Fd-F|
5|FCaCaCGFCGFCaCbF-F-F-F--a-|
3|F---F---C---C---C---C---d-|
2|--F---C---C---C---C---d---|

6|d-F-G-G-a-a-b-b-a-a-G-G-F-|
5|-a-a-a-a-a-a-b-b-b-b-b-b-b|
3|--d---d---d---e---e---d---|
2|d---d---d---e---e---d---d-|

6|F-F-F-e-e-D-D-F-F-e--e--e-|
5|-b-a-a-a-a-a-a-a-a-aF-aF-a|
3|d---C---C---C---C---F---F-|
2|--C---C---C---C---F---F---|

6|-C--C-C-d-d-e-e-F-F-a-a-Ga|
5|F-aF-F-F-a-a-a-a-a-a-a-a--|
3|--F---F---d---d---d---d---|
2|F---F---d---d---d---d---e-|

6|-GF-F-e-e-d-d-C-C-f-f-G-G-|
5|---a-a-a-a-a-a-G-G-G-G-G-G|
3|e---e---d---d---C---C---C-|
2|--e---d---d---C---C---C---|

7|C-C-----------------C--C--|
6|-C-CbCbCaCaCGCGCaCaC-Fd-Fd|
3|--C---F---F---F---F---d---|
2|C---F---F---F---F---d---d-|

7|C--C------C--C----C--d--d-|
6|-Fd-Fda-F--Fd-F-F--Fd-Fd-d|
5|-------b-b-----b-b--------|
3|d---d---d-----------------|
2|--d---d-----b---b---b---b-|
1|----------b---b---b---b---|

7|C--C--C---------e-e-d-d-C-|
6|-Ge-Ge-GebGeGebee-e-d-d-C-|
3|--e---e---e---e---e---e---|
2|e---e---e---e---e---e---e-|

7|C-------------------------|
6|C-b-b-e--e--e--d--d-d-C--C|
5|--b-b--ae-ae-ae-ae-a-a-eC-|
3|e---e---a---a---a---a---e-|
2|--e---a---a---a---a---e---|

6|--C-----------------------|
5|eC-eCGeCGCGCbFCbFCbFCaFCaC|
3|--e---e---e---F---F---F---|
2|e---e---e---F---F---F---F-|

6|------------C-d-e-Fd-Fd-F-|
5|aCGFCGFCaCbF-F-F-F--a--a-a|
3|F---C---C---C---C---d---d-|
2|--C---C---C---C---d---d---|

6|G-G-a-a-b-b-a-a-G-G-F-F-F-|
5|-a-a-a-a-b-b-b-b-b-b-b-b-a|
3|--d---d---e---e---d---d---|
2|d---d---e---e---d---d---C-|

6|F-e-e-D-D-F-F-e--e--e--C--|
5|-a-a-a-a-a-a-a-aF-aF-aF-aF|
3|C---C---C---C---F---F---F-|
2|--C---C---C---F---F---F---|

6|C-C-d-d-e-e-F-F-a-a-Ga-GF-|
5|-F-F-a-a-a-a-a-a-a-a-----a|
3|--F---d---d---d---d---e---|
2|F---d---d---d---d---e---e-|

7|----------------------C-C-|
6|F-e-e-d-d-C-C-f-f-G-G--C-C|
5|-a-a-a-a-a-G-G-G-G-G-G----|
3|e---d---d---C---C---C---C-|
2|--d---d---C---C---C---C---|

7|----------------C--C--C--C|
6|bCbCaCaCGCGCaCaC-Fd-Fd-Fd-|
3|--F---F---F---F---d---d---|
2|F---F---F---F---d---d---d-|

7|------C--C----C--d--d-C--C|
6|Fda-F--Fd-F-F--Fd-Fd-d-Ge-|
5|---b-b-----b-b------------|
3|d---d-------------------e-|
2|--d-----b---b---b---b-e---|
1|------b---b---b---b-------|

7|--C---------e-e-d-d-C-C---|
6|Ge-GebGeGebee-e-d-d-C-C-b-|
5|------------------------b-|
3|--e---e---e---e---e---e---|
2|e---e---e---e---e---e---e-|

6|b-------------------------|
5|b-------------d---e---G---|
4|--e---G---b-------e---G---|
3|e-------e-------e-------e-|
2|--e-G-b---e-G-b---e-G-b---|

6|----d-----------e---F---G-|
5|b---d---G---b---e---F---G-|
4|b-------G---b-------------|
3|------e-------e-------e-eF|
2|e-G-b---e-G-b---e-G-b-----|

6|------e---G---a-----------|
5|--b---e---G---a-----------|
4|--b-----------------------|
3|ededC-dC--------a---a---a-|
2|-----b--babaGea---a---a---|

5|--------------------a-----|
4|--------------------a-----|
3|--a---a---a---a---a---a---|
2|a---a---a---a---a---a---a-|

3|a---a---a---a---a---a---a-|
2|--a---a---a---a---a---a---|

5|-CeGaGeC-CeGaGeC-CeGaGeC-C|
4|a-------a-------a-------a-|
3|--a---a---a---a---a---a---|
2|a---a---a---a---a---a---a-|

5|eGaGeC---ded-----ded-----d|
4|------eGb---bGeGb---bGeGb-|
3|a---a---e---e---e---e---e-|
2|--a---e---e---e---e---e---|

5|ed-----ded------C-CdedeFGa|
4|--bGeGb---bGaGab-b--------|
3|--e---e---e---d---d---d---|
2|e---e---e---d---d---d---d-|

6|d---C--d--C-----C---------|
6|----e---------------------|
5|-------------b----G-G-G-G-|
5|b------a--a--G--a-e-e-e-e-|
3|d---d---d---d---d---e---e-|
2|--d---d---d---d---e---e---|

5|G-G---a---b-a---G--e------|
5|e-e---F---G-F---e--C----e-|
4|----------------------b-b-|
4|----------------------G-G-|
3|--e---e---e---e---e---e---|
2|e---e---e---e---e---e---C-|

6|-----------------------Cde|
5|----e-----eFGabaGabaGab---|
4|----b---------------------|
4|----G---------------------|
3|C---C---C---C---C---C---C-|
2|--C---C---C---C---C---C---|

6|GeGabFC-aFC-e--F---e-e--e-|
6|------------G--a---G-G----|
5|-------a---a------------b-|
3|--C---F---F---F---F---C---|
2|C---F---F---F---F---C---C-|

5|-b--G-----------------e-F-|
5|-G--e-------------C-CdC-d-|
4|-------G------------------|
4|-------e--FdFGaFab-a------|
3|C---C---C---d---d---d---d-|
2|--C---C---d---d---d---d---|

5|------C-d-dFaFd--------Cd-|
4|--F-a----a-----aGeGabGb--b|
3|--d---d---d---d---e---e---|
2|d---d---d---d---e---e---e-|

6|------------------e---d---|
5|--F-G---------------------|
5|ded-e-------d-e-eG-bGe-bGd|
4|--------G-b----b----------|
3|e---e---e---e---e---e---a-|
2|--e---e---e---e---e---a---|

6|--d-----d-----d-d---d---C-|
6|------------------------e-|
5|bG-bGdbG-bGdbG-G-bGd-bGd--|
3|--a---a---a---a---a---a---|
2|a---a---a---a---a---a---a-|

6|d-C---------------C---C-C-|
5|b-G-fC---Cf-CfGCfG-CfG-G-f|
4|------GfG--G--------------|
3|a---G---G---G---G---G---G-|
2|--G---G---G---G---G---G---|

7|----C---------------------|
6|-CfG-GfC--------------C---|
5|--------a-----a---b-------|
5|G-------F---C-F---G---a---|
4|------------a-----------Fa|
3|--------F---F-F---F---F-F-|
3|--G---G-C---C-C---C---C-C-|
2|G---G---F---F-F---F---F-F-|

7|------C-------------------|
6|---CFa-aFC----------------|
5|--------------G-----G---b-|
5|CFa-------aFCFf---C-f---G-|
4|------------------G-------|
3|--------------f---f-f---f-|
3|--------------C---C-C---C-|
2|--------------f---f-f---f-|

7|------------C-------------|
6|--C------CfG-GfC----------|
5|------------------------G-|
5|--G---CfG-------GfCfe---e-|
4|----fG--------------b-----|
3|--f-f-------------------G-|
3|--C-C---------------e---e-|
2|--f-f---------------e---b-|
2|--------------------b-----|

6|-----C--D--e--F--G--a-G-a-|
5|--b-----------------------|
5|--G--G--G--G--G--G--G-----|
4|--e--e--e--e--e--e--------|
3|--b--b--b--b--b--b--------|
3|--e--e--e--e--e--e--e---e-|
2|----------------------e---|

6|baFCaFC-FC--C----F--C--C--|
6|-----------------a--F-----|
5|-------a--aF-aFC-------a--|
3|--D---D---D---D---D---D---|
2|D---D---D---D---D---D---D-|

6|--------------------CdedCd|
5|a--F--e-------------------|
5|F--C--C---C-CdeCdDea------|
4|--------ab-a--------------|
3|------b---b---b--b--b-----|
3|D---D-F---F---F--F--F---b-|
2|--D---b---b---b--b--b-b---|

6|edCdedCdeaGa--C-C---C--C-C|
6|--------------b-a---G--a-G|
4|------------C---C---C--C-C|
3|------------G---G---G--G-G|
3|--b---b---b-C---C---C--C-C|
2|b---b---b-----------------|

7|--e---d---C---d-----------|
6|---aeC-aeC-aeC-aeCdFaba-dF|
4|----C---C---C---C---d---d-|
3|--C---C---C---C---d---d---|

6|aba-----------d-d---------|
5|----dFaba-dFab-a-aFd------|
4|--d---d-------------------|
4|--------------------aGab--|
3|d---d-----d---d---d---d---|
3|------------------------eG|
2|--------d---d---d---d---e-|

6|----------------------e---|
5|----------------------b---|
5|--------------e-eGbeGbe---|
4|-d--de-deGdeGb-b----------|
3|e---e---e---e---e---e-e---|
3|b-Gb--b-------------------|
2|--e---e---e---e---e---e---|
2|----------------------b---|

6|------------------------c-|
5|be-----------------cfcfa-f|
4|--b---cD-cDfcDfaDfa-------|
3|------f-------------------|
3|----fa--a-f---f---f---f---|
2|b-e-f---f---f---f---f---f-|

6|-cc-----cff--f--f--D--D-D-|
6|--f-----------------------|
5|a-f---fa---Af-Af-Af-Af-A-A|
4|----------A---------------|
3|--f-----------------------|
3|f-c-------A---------------|
2|--f-----------------------|

6|d--d--d---------c--c--c---|
5|-fd-fd-fdafdadad-gd-gd-gdA|
4|f---------------g---------|
3|f---------------g---------|

6|--------------c-d-D-f-gD-g|
5|gdAdAdagdagdAd-g-g-g-g--A-|
4|------d---------------D---|
3|------d---------------D---|

7|------------c-c-----------|
6|D-g-a-a-A-A--c-cAcAcacacgc|
5|-A-A-A-A-A-A--------------|
4|------------f-------D-----|
3|------------f-------D-----|

6|gcg-g-f-f-e-e-g-g-f--f--f-|
5|---A-A-A-A-A-A-A-A-Ag-Ag-A|
4|--d---------------g-------|
3|--d---------------g-------|

6|-d--d-d-D-D-f-f-g-g-A-A-aA|
5|g-Ag-g-g-A-A-A-A-A-A-A-A--|
4|--------D---------------f-|
3|--------D---------------f-|

6|-ag-g-f-f-D-D-d-d-F-F-a-a-|
5|---A-A-A-A-A-A-a-a-a-a-a-a|
4|------D-------d-----------|
3|------D-------d-----------|

7|d-d-c-c-------------d--d--|
6|-d-d-d-dAdAdadadAdAd-gD-gD|
4|----g---------------c-----|
3|----g---------------c-----|

7|d--d------d--d----d--D--D-|
6|-gD-gDAcgc-gD-gcgc-gD-gD-D|
4|----------D-------e-------|
3|----------D-------e-------|

7|d--d--d--c----c-f-f-D-D-d-|
6|-af-af-af-afaf-ff-f-D-D-d-|
4|f-------------------------|
3|f---------------f---------|
2|----------------f---------|

7|d-c-c---------------------|
6|d-c-c-F--F--F--e--e-e-D--D|
5|-------bF-bF-bF-bF-b-b-FD-|
3|--------b---b---b---b---F-|
2|------b---b---b---b---F---|

6|--D---------C--C--C-------|
5|FD-FDAFDADAD-GD-GD-GDbGDbD|
3|--F---F---F---G---G---G---|
2|F---F---F---G---G---G---G-|

6|----------C-D-e-F-Ge-Ge-G-|
5|bDAGDAGDbD-G-G-G-G--b--b-b|
3|G---D---D---D---D---e---e-|
2|--D---D---D---D---e---e---|

7|--------C-C---------------|
6|A-A-b-b--C-CbCbCACACGCGCG-|
5|-b-b-b-b-----------------b|
3|--e---e---F---F---e---e---|
2|e---e---F---F---e---e---D-|

6|G-F-F-f-f-G-G-F--F--F--D--|
5|-b-b-b-b-b-b-b-bG-bG-bG-bG|
3|D---D---D---D---G---G---G-|
2|--D---D---D---G---G---G---|

6|D-D-e-e-F-F-G-G-b-b-Ab-AG-|
5|-G-G-b-b-b-b-b-b-b-b-----b|
3|--G---e---e---e---e---F---|
2|G---e---e---e---e---F---F-|

7|----------------------D-D-|
6|G-F-F-e-e-D-D-g-g-A-A--D-D|
5|-b-b-b-b-b-A-A-A-A-A-A----|
3|F---e---e---D---D---D---D-|
2|--e---e---D---D---D---D---|

7|C-C-------------D--D--D--D|
6|-D-DbDbDADADbDbD-Ge-Ge-Ge-|
3|--G---G---G---G---e---e---|
2|G---G---G---G---e---e---e-|

7|------D--D----D--e--e-D--D|
6|GebCGC-Ge-GCGC-Ge-Ge-e-AF-|
3|e---e---C---C---C---C---F-|
2|--e---C---C---C---C---F---|

7|--D--C----C-F-F-e-e-D-D-C-|
6|AF-AF-AFAF-FF-F-e-e-D-D-C-|
3|--F---F---F---F---F---F---|
2|F---F---F---F---F---F---F-|

7|C-------------------------|
6|C-GC-GC-GC-FC-FCFCf--f--f-|
5|----G--G--G--G-----Gf-Gf-G|
4|----C---C---C---C---------|
3|F-C---C---C---C-----G---G-|
2|------------------G---G---|

6|-c--c-c-D--D--D--C--C-C-c-|
5|f-Gf-f-f-Af-Af-Af-Af-f-f-A|
3|--G---G---A---A---A---A---|
2|G---G---A---A---A---A---f-|

7|----------------------c-c-|
6|-c--C-D-f-F-G-AFCAFCAC-C-C|
5|f-Af-f-A-A-A-A------------|
3|f---f---f---f---F---F---F-|
2|--f---f---f---F---F---F---|

7|C-C-D-D-C-C-c-c-----------|
6|-C-C-D-D-D-D-D-DADADACACGC|
3|--F---G---G---F---F---f---|
2|F---G---G---F---F---f---f-|

6|GCgCgCACACGC-GC-GC-fC-f-f-|
5|------------A--A--A--A-A-A|
3|f---f---f---A---A---A---A-|
2|--f---f---A---A---A---A---|

7|------------C-C-cC-c------|
6|FCFCGCGCACAC-C-C----ACACGC|
3|--F---F---F---F---G---G---|
2|F---F---F---F---G---G---F-|

7|--------------c-c-f-f-D-D-|
6|GCFCFCfcfcacac-c-c-f-f-f-f|
3|F---F---f---f---f---f---A-|
2|--F---f---f---f---f---A---|

7|C-C-c-c-C-C-f--f--f--f--C-|
6|-f-f-f-f-f-f-AF-AF-AF-AF-D|
3|--A---A---A---F---F---F---|
2|A---A---A---F---F---F---F-|

7|--f--f----f--F--F-fc-fc-fc|
6|AD-AF-ADAD-AF-AF-F--G--G--|
3|F---D---D---D---D---G---G-|
2|--D---D---D---D---G---G---|

7|-Dc-c-D-G-G-F-F-f-f-D-D---|
6|G--G-G-GG-G-F-F-f-f-D-D---|
4|------------------------G-|
3|--G---G---G---G---G---G---|
2|G---G---G---G---G---G---G-|

6|------------------c---D---|
5|--c---D---F---G---c---D---|
4|--------------G-----------|
3|c-D-G---c-D-G---c-D-G---c-|
2|------G-------G-------G---|

7|--------------------c-----|
6|F---c---D---G---A---c---D-|
5|F---c---D---G---A-------D-|
3|D-G---c-D-G---c-D-G-GAGFGF|
2|----G-------G-------------|

7|------c---C---------------|
6|--G---c---C---------------|
5|--G-----------------------|
3|fDFfDCDCc-C---------------|
2|---------GC---------------|
2|----------G---------------|
`;

/* --------------------------------------------------------------------------------------------- */
//																							     //
// This code is awful and unoptimized. Don't even bother reading it, let alone trying to fix it. //
//																							     //
/* --------------------------------------------------------------------------------------------- */

const noteValues = [
    "B0", "C1", "CS1", "D1", "DS1", "E1", "F1", "FS1", "G1", "GS1", "A1", "AS1", "B1", "C2", "CS2", "D2", "DS2", "E2", "F2", "FS2", "G2", "GS2", "A2", "AS2",
    "B2", "C3", "CS3", "D3", "DS3", "E3", "F3", "FS3", "G3", "GS3", "A3", "AS3", "B3", "C4", "CS4", "D4", "DS4", "E4", "F4", "FS4", "G4", "GS4", "A4", "AS4",
    "B4", "C5", "CS5", "D5", "DS5", "E5", "F5", "FS5", "G5", "GS5", "A5", "AS5", "B5", "C6", "CS6", "D6", "DS6", "E6", "F6", "FS6", "G6", "GS6", "A6", "AS6",
    "B6", "C7", "CS7", "D7", "DS7", "E7", "F7", "FS7", "G7", "GS7", "A7", "AS7", "B7", "C8", "CS8", "D8", "DS8"
];

// Clean output dir
try{
    fs.unlinkSync("js/output/final");
}catch(e){}

const normalizeLetter = char => {
    const upChar = char.toUpperCase();
    return (char == upChar) ? (char + "S") : upChar;
}

// TODO: let LEFT - RIGHT matter

// Remove useless data - for now - and split string in blocks that play together
const lines = trad.replace(/(LH:)|(RH:)/g, "").split("\n\n").map(el => el.replace(/\n/g, ""));

// For every chunk of notes, split it in other chunks (the actual rows that are between pipes), use the number to
// determine the octave and substitute every note with right the noteValues index (the same index that Arduino uses)
const f = [];	// Save here the parsed data
for(const line of lines){
    const t = line.split(/\|/);

    const arr = [];
    for(let i = 0; i < (t.length-1)/2; i++){
        arr.push([]);
        const str = t[i*2+1]
        for(let j = 0; j < 26; j++)
            arr[i].push(str.charAt(j) == "-" ? 0 : (noteValues.indexOf(normalizeLetter(str.charAt(j)) + t[i*2])));
    }
    f.push(arr);
	// Beautiful triple for indeed
}

const layers = [];
const mapLayers = [];
const notesLayers = [];

for(let i = 0; i<nOfLayers; i++){
    layers.push([]);
    mapLayers.push([]);
    notesLayers.push([]);
}

for(const line of f){
    // line: chunk between 2 \n

    const s = [];
    var n = 1;

    for(let i = 0; i < 26; i++)
        for(let j = 0; j < line.length; j++)
            for(let l = 0; l < n; l++){
                if(!s[l]) s[l] = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ];	// Default: fill with 0
                
                if(!s[l][i]){
                    s[l][i] = line[j][i];
                    break;
                }
                
                if(l+1 == n) n++;
            }

    for(let i = 0; i < nOfLayers; i++)
        layers[i].push(...s[i] ?? [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]);
}

// Should I do this stuff in the former loops? Yes.
const hexify = (bitMap, b, n) =>
    JSON.stringify(
        bitMap
        .match(/.{1,8}/g)
        .map(el => {
            const a = parseInt(el, 2).toString(16);
            return "0x" + ("0".repeat(2-a.length)) + a;
        })
    )
    .replace("]", " };")
    .replace(/"/g, "").replace("[", `const byte PROGMEM hex${b ? "Map" : "Notes"}_${n}[] = { `)
    .replace(/-/g, "0");	// There's a bug, somewhere, that can spawn dashes (it actually only happened one time, so idk)... Maybe I'll try to fix it in the future

// Layers has all the notes, now begins memory optimization with a bit map so that the Arduino can store more notes
var maps = "";
var notes= "";
var arrs = "";
for(let n = 0; n < nOfLayers; n++){

    var bitNotes = "";
    var bitMap = "";

    for(let i = 0; i<layers[n].length; i++){
        const note = layers[n][i];

        bitMap += note ? "1" : "0";

        if(note){
            const a = note.toString(2);
            bitNotes += "0".repeat(7-a.length) + a;
        }
    }
    
    if(!bitNotes || !bitMap) continue;
    // fs.writeFileSync(`js/maps/hexMap_${n}`, hexify(bitMap, 0, n));
    // fs.writeFileSync(`js/notes/hexNotes_${n}`, hexify(bitNotes, 1, n));
    maps += hexify(bitMap, 1, n) + "\n";
    notes += hexify(bitNotes, 0, n) + "\n";
    arrs += `hexMap_${n}, hexNotes_${n}${n+1!=nOfLayers ? ", " : " "}`;
}

const final = `${maps}\n${notes}\nconst byte * const PROGMEM song[] = { ${arrs}};`
fs.writeFileSync(`js/output/final`, final);